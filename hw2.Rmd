Homework 1 - [Your team name here]
========================================================

### Task 0 - Load the data

```{r}
suppressMessages(library(dplyr))
load("lego_sales.RData")
```


### Task 1 - Tidying the data

Intialize the Data Frame
```{r}
# find top level names
name0 = sales %>% unlist(recursive=FALSE) %>% names() %>% unique()

# identify number of rows based on maxiumum number of each catagory
sum_n = sapply(name0, function(x) 
            sapply(sales, function(y) 
                length(y[[x]]))) %>% colSums()

# identify subcatagory names
cat_name = sapply(name0, function(x)
                sapply(sales, function(y)
                    y[[x]] %>% unlist() %>% names()) %>%
                unlist() %>% 
                unique()) 

name = c(name0, unlist(cat_name, use.names=FALSE))

# intialize the data frame given the extents discovered above
lego_df = data.frame(matrix(nrow = max(sum_n), ncol = length(name)))
colnames(lego_df) = name
```

Fill the Data Frame
```{r}
# A 'safe' rep function that returns NA value when encountering NULL
rep_safe = function(x, t) {
    if (is.null(x)) {
        rep(NA, t)
    } else if (length(x) == 1) {
        rep(x, t)
    } else {
        replicate(t, x)
    }
}
```

Loop over and fill the data frame
```{r}
for (n in name) {
    lego_df[n] = sapply(sales, function(x) 
            rep_safe(x[[n]], length(x[['purchases']]))) %>%
            unlist()
    for (c in cat_name[[n]]) {
        lego_df[c] = sapply(sales, function(x) 
                        sapply(x[[n]], function(x) x[[c]])) %>%
                        unlist()
    }
}
```


## Task 2 - Processing the data

1. What was the most common first name of purchasers? Last name?

The most common first name is 
```{r}
lego_df %>%  
    select(first_name, last_name) %>%
    distinct() %>%
    count(first_name) %>% 
    slice(which.max(n))

lego_df %>%  
    select(first_name, last_name) %>%
    distinct() %>%
    count(last_name) %>% 
    slice(which.max(n))
```

2. What are the five most popular lego sets based on these data?

```{r}
lego_df %>%
    select()
```

3. Which five customers have spent the most money so far and how much have they spent?

```{r}
lego_df %>%
    select(first_name, last_name, Quantity, USPrice) %>%
    group_by(first_name, last_name) %>%
```

4. Which lego theme has made the most money for lego?

```{r}
```

5. Do men or women buy more lego sets (per person) on average?

```{r}
lego_df %>% 
    select(first_name, last_name, gender, Quantity) %>%
    mutate()
```

6. What are the five most popular hobbies of lego purchasers?

```{r}
```

7. How many total pieces have been purchased from lego by these customers?

```{r}
```

8. What state has spent the most money on legos? Hint - customer area codes may prove useful for this.

```{r}
```
